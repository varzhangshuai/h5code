function gotoSign(e){delCookie("_unionid");var t=route+"/app/giftsline/sign.html";e?e&&e++:(e=uriObj.count||1,e++),t+="?count="+e,uriObj.sharerid&&(t+="&sharerid="+uriObj.sharerid),window.location.href=t}function getUnionid(e){if(!e){var t=uriObj.count||2;window.location.href=route+"/app/giftsline/sign.html?count="+t}e.code||gotoSign(),$.ajax({type:"GET",url:route+"/wx/api/oauth/wxoauth",data:e,success:function(e){if(1==e.code){if(console.log(e),!_unionid||""==_unionid){e.data.unionid;setCookie("_unionid",e.data.unionid),delCookie("_userid"),delCookie("_enid"),delCookie("_status")}wxsign(e.data,getData)}else toast("认证失败")},error:function(e){console.log(e)}})}function wxsign(e,t){e&&$.ajax({type:"POST",url:route+"/costin/mapi/wechat/auth",data:e,success:function(e){if(1==e.code){var i=e.original;i&&null!=i&&(i.enid&&setCookie("_enid",i.enid),i.status&&setCookie("_status",i.status),i.userid&&setCookie("_userid",i.userid)),t()}else 10016==e.code?gotoSign():toast(e.msg)},error:function(e){console.log(e)}})}function getData(e){var t=getCookies("_unionid");if(!e&&isWechat){if(!t||void 0==t)return!1;e={_unionid:t},uriObj.sharerid&&(e.sharerid=uriObj.sharerid)}isApp&&!e.enid||$.ajax({type:"GET",url:route+"/costin/mapi/lottery/giftsline",data:e,success:function(e){1==e.code?($("#home-content").css("display","block"),renderIndex(indexData=e.original)):10016==e.code?gotoSign():10001==e.code?$("#home-content").css("display","none"):($("#home-content").css("display","none"),alert(e.msg))},error:function(e){console.log(e)}})}function renderIndex(e){if(e&&null!=e&&""!=e||$(".home-whole").css("display","none"),0==e.commodity.length);else for(var t=e.commodity,i=t.length,o=0;o<i;o++){var n=t[o].commodityid;n>3&&(n+=1),$(".lottery-unit-"+(n-1)+" img").attr("src",t[o].commodityImageUrl)}if(0==e.express.length)$("#home-ul-none").css("display","block"),$("#home-ul").css("display","none");else{$("#home-ul").css("display","block"),$("#home-ul-none").css("display","none");for(var i=e.express.length,s=e.express,a=$("#home-ul").html(),r="",o=0;o<i;o++)r+=a;$("#home-ul").html(r),$(".home-express-item").each(function(e){var t="";t=10==s[e].status?"已发货":1==s[e].status||5==s[e].status?"待发货":"领奖";var i=s[e].sponsor.split(" ");$(this).find(".item-statusing").text(t),$(this).find(".item-prize").text(s[e].commodityName),$(this).find(".item-patron").text(i[0]),$(this).find(".item-name").text(i[1]),$(this).find(".item-status").text(s[e].statusName),$(this).find(".item-img").attr("src",s[e].commodityImageUrl),$(this).find(".toWinning").attr("id","recordid"+s[e].recordid),$(this).find(".toWinning").addClass("status"+s[e].status)})}0==e.can?$(".home-enjoy-key").addClass("count-0"):0==e.frequency?$(".home-enjoy-key").addClass("count-0"):1==e.frequency?($("#frequency").text(e.frequency),$(".home-counts").css("display","none")):($(".home-counts").css("display","block"),$(".lottery-button").css("display","block"),$("#frequency").text(e.frequency))}function renderAdd(e){$.ajax({type:"GET",url:route+"/costin/mapi/lottery/giftsline/express",data:e,success:function(e){1==e.code?addData(e.original):e.code},error:function(e){console.log(e)}})}function selectAdd(e){$.ajax({type:"POST",url:route+"/costin/mapi/lottery/giftsline/address",data:e,success:function(t){if(1==t.code)toAddress(e.recordid);else if(10016==t.code)gotoSign();else if(toast(t.msg),"60003"==t.code){var i=e.recordid;setTimeout(function(){toAddress(i)},2e3)}},error:function(e){console.log(e)}})}function addData(e){isWechat?isAppAdd(e):isApp&&isAppAdd(e)}function isWeixinAdd(e){0==e?$(".isStatus").html("添加地址领奖"):$(".isStatus").html("查看发货进度")}function isAppAdd(e){if(0==e.status){window.location.href=route+"/app/giftsline/index.html"}else{var t={name:e.name,addr:e.addr,cityName:e.cityName,addressid:e.addressid,expressName:e.expressName,expressCode:e.expressCode};1==e.status?$(".orderinfo").css("display","none"):10==e.status&&$(".orderinfo").css("display","block"),appAddDetail($("#orderdetail"),t)}if(e.commodityid){var i=e.commodityid,o=e.sponsor.split(" ");$(".win-item-prize").text(e.commodityName),$(".win-item-patron").text(o[0]),$(".win-item-name").text(o[1]),$(".win-item-img").attr("src",e.commodityImageUrl),$(".win-item-detail").attr("id","pro"+i)}else $("#add-image").css("display","none")}function appAddDetail(e,t){e.find(".item-express-name").html(t.expressName),e.find(".item-express-number").html(t.expressCode),e.find(".name").html(t.name),e.find(".phone").html(t.phone),e.find(".addr").html(t.addr),e.find("#add_revise").parent().attr("id","addr"+t.addressid)}function winningData(e){var t=e.prize.sponsor.split(" ");$(".win-item-prizename").text(e.prize.commodityName),$(".win-item-sponsor").text(t[0]),$(".win-item-name").text(t[1]),$(".award-winn-shop img").attr("src",e.prize.commodityImageUrl),$(".award-button").attr("id","recordid"+e.recordid);for(var i=e.other,o=$("#award-ul").html(),n="",s=0;s<i.length;s++)n+=o;$("#award-ul").html(n),$(".win-other-item").each(function(e){var t=i[e].sponsor.split(" ");$(this).find(".win-item-prize").text(i[e].commodityName),$(this).find(".win-item-patron").text(t[0]),$(this).find(".win-item-name").text(t[1]),$(this).find(".win-item-img").attr("src",i[e].commodityImageUrl),$(this).find(".win-item-detail").attr("id","winprize"+i[e].commodityid)})}function renderPrize(e){e.recordid&&setCookie("_recordid",e.recordid),$.ajax({type:"GET",url:route+"/costin/mapi/lottery/giftsline/prize",data:e,success:function(e){$("#log1").html(JSON.stringify(e)),1==e.code?winningData(e.original):"10016"==e.code&&gotoSign()},error:function(e){console.log(e)}})}function clickLottery(e,t){var i=$("#frequency").text();$.ajax({type:"GET",url:route+"/costin/mapi/lottery/giftsline/lottery",data:e,success:function(e){if($("#log0").html("ajax"+JSON.stringify(e)),1==e.code){--i>1?$("#frequency").text(i):1==i?($(".count-0").removeClass("count-0"),$(".home-counts").css("display","none"),$("#frequency").text(i),$(".lottery-button").css("display","none")):($(".home-enjoy-key").addClass("count-0"),$(".home-counts").css("display","none"));var o=e.original.commodityid,n=e.original.commodityImageUrl,s=e.original.recordid;t(o,n,s)}else 10016==e.code?gotoSign():10001==e.code?alert("系统错误，请稍后再试"):alert("您已抽过奖，可以直接领取奖品")},error:function(e){console.log(e)}})}function animatLottery(e,t,i){if($("#log0").html("animate"+e+t+i),isClick){$(".home-share").show();return!1}lottery.speed=100,e<=3&&(e-=1),console.log(e),lottery.prize=e,$(".home-prize-box").attr("src",t),roll(),$(".mask-lamp").css("display","block"),isClick=!0,setTimeout(function(){$(".home-prize-gift").css("display","block"),$(".mask-lamp").css("display","none"),setTimeout(animateStart,500),setTimeout(function(){toWinning(i)},4e3)},5e3)}function animateStart(e){$(".chest-close").addClass("shake");var t=".chest-close";this.addEventListener("webkitAnimationEnd",function(){$(t).closest(".open-has").addClass("opened"),setTimeout(function(){$(t).removeClass("show"),$(t).closest(".mod-chest").find(".chest-open").addClass("show"),setTimeout(function(){$(".chest-open").addClass("blur"),setTimeout(e,2e3)},1e3)},500)},!1)}function toWinning(e){var t="/app/giftsline/winning.html?id="+e+"&_t="+(new Date).getTime();window.location.href=t}function toAddrlist(e,t){var i=(new Date).getTime();if(isApp){var o="/app/giftsline/adrlist.html?id="+e+"&_t="+i;t&&(o+="&addressid="+t),window.location.href=o}}function toAddress(e){var t="/app/giftsline/app_adddetail.html?id="+e+"&_t="+(new Date).getTime();window.location.href=t}function customer(){$(".logo_2").click(function(){"none"==$("#alert-ios").css("display")&&($("#alert-ios").css("display","block"),$("#mask").css("display","block"),isWechat?$(".phone-inWechat").css("display","block"):$(".phone-inApp").css("display","block"))}),$("#alert-cancel").click(function(){"block"==$("#alert-ios").css("display")&&($("#alert-ios").css("display","none"),$("#mask").css("display","none"))})}function appShareToast(){$("#add_share").click(function(){$("#mask-bac").css("display","block")})}function closeShareToast(){$("#click-area").click(function(){$("#mask-bac").css("display","none")})}function toast(e){var t=$("<div id='toast'></div>");$("body").append(t);var i={display:"none",background:"rgba(0, 0, 0, 0.7)",position:"fixed","z-index":"10",width:"4rem","line-height":"0.8rem",left:"3rem",top:"50%","margin-top":" -0.66666667rem","border-radius":" 0.16rem","font-size":"0.4rem",color:"white","text-align":" center",padding:"0.26666667rem 0.13333333rem"};$("#toast").css(i),$("#toast").css("display","block").html(e),setTimeout(function(){$("#toast").css("display","none").html()},2e3)}function openApp(){window.location.href=route+"/app/giftsline/index.html"}var _unionid=getCookies("_unionid"),route=myRoutes(),uriObj=getUserid(),indexData=new Object,isClick=!1,shareObj={topName:"礼尚往来",shareurl:route+"/app/giftsline/index.html",title:"今日好礼相送，但看花落谁家",describe:"校友馈赠，敬请笑纳"};